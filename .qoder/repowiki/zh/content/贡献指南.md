# 贡献指南

<cite>
**本文档引用的文件**  
- [README.md](file://README.md)
- [package.json](file://package.json)
- [biome.json](file://biome.json)
- [commitlint.config.mjs](file://commitlint.config.mjs)
- [vitest.config.ts](file://vitest.config.ts)
- [knip.json](file://knip.json)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml)
- [docs/development-guide.md](file://docs/development-guide.md)
- [docs/architecture.md](file://docs/architecture.md)
- [packages/git/src/index.ts](file://packages/git/src/index.ts)
- [packages/git/src/commands/commit.ts](file://packages/git/src/commands/commit.ts)
- [packages/shared/src/index.ts](file://packages/shared/src/index.ts)
</cite>

## 目录
1. [简介](#简介)
2. [贡献流程](#贡献流程)
3. [代码风格要求](#代码风格要求)
4. [测试策略](#测试策略)
5. [代码质量工具](#代码质量工具)
6. [良好的PR示例](#良好的pr示例)
7. [入门贡献方式](#入门贡献方式)
8. [结论](#结论)

## 简介
欢迎参与 **nemo-cli** 项目的开发！本贡献指南旨在为社区成员提供清晰的参与路径，涵盖从环境搭建到提交PR的完整流程。项目采用 monorepo 架构，使用 pnpm workspaces 管理多个独立发布的包，包括 `@nemo-cli/git`、`@nemo-cli/ai`、`@nemo-cli/file` 等。我们鼓励所有开发者遵循统一的代码规范和提交标准，共同维护项目的高质量。

## 贡献流程

### Fork 仓库
首先，在 GitHub 上 Fork `nemo-cli` 仓库到您的个人账户。

### 克隆与分支
克隆您的 Fork 仓库并创建特性分支：
```bash
git clone git@github.com:your-username/nemo-cli.git
cd nemo-cli
git checkout -b feature/your-feature-name
```

### 开发环境搭建
安装依赖并构建项目：
```bash
# 安装依赖
pnpm install

# 构建所有包
pnpm build

# 全局链接CLI（ng命令）
cd packages/git && pnpm link -g
```

### 提交PR
完成开发后，提交代码并创建PR：
```bash
# 格式化代码
pnpm format

# 运行测试
pnpm test

# 交互式提交
ng commit
```

将更改推送到您的 Fork 仓库，并在 GitHub 上创建 Pull Request。

**Section sources**
- [README.md](file://README.md#L1-L64)
- [docs/development-guide.md](file://docs/development-guide.md#L1-L447)

## 代码风格要求

### Biome 格式化与 Linting
项目使用 **Biome** 统一代码格式化和 linting，替代传统的 ESLint + Prettier 组合。主要规则包括：
- 单引号
- 无分号（ES5 尾逗号除外）
- 2 空格缩进
- 120 字符行宽
- 导入排序（按预定义分组）
- 属性排序

运行格式化命令：
```bash
pnpm format
```

### 提交信息规范
使用 **commitlint** 规范提交信息，确保提交历史清晰可读。提交信息格式为：
```
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

支持的提交类型：
- `feat`: 新功能
- `fix`: Bug 修复
- `docs`: 文档更新
- `style`: 代码格式
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试
- `build`: 构建系统
- `ci`: CI 配置
- `chore`: 杂项
- `revert`: 回滚
- `wip`: 进行中
- `release`: 发布

可选的 scope：
- `git`: @nemo-cli/git
- `shared`: @nemo-cli/shared
- `ai`: @nemo-cli/ai
- `ui`: @nemo-cli/ui
- `packages`: 多包变更
- `mail`: @nemo-cli/mail

使用 `ng commit` 命令进行交互式提交，自动遵循规范。

**Section sources**
- [package.json](file://package.json#L1-L66)
- [biome.json](file://biome.json#L1-L160)
- [commitlint.config.mjs](file://commitlint.config.mjs#L1-L15)

## 测试策略

### 运行测试套件
项目使用 **Vitest** 作为测试框架，支持单元测试和覆盖率报告。运行测试命令：
```bash
# 运行所有测试
pnpm test

# 运行特定包测试
pnpm run --filter=@nemo-cli/git test

# 生成覆盖率报告
pnpm coverage
```

### 测试文件位置
测试文件位于各包的 `__tests__` 目录或 `src/**/__tests__` 目录中，遵循 `.test.ts` 命名约定。

### 测试示例
```typescript
// packages/git/__tests__/utils.test.ts
import { describe, it, expect } from 'vitest'
import { myUtil } from '../src/utils'

describe('myUtil', () => {
  it('should work correctly', () => {
    expect(myUtil()).toBe(expected)
  })
})
```

**Section sources**
- [vitest.config.ts](file://vitest.config.ts#L1-L12)
- [docs/development-guide.md](file://docs/development-guide.md#L191-L229)

## 代码质量工具

### Knip
**Knip** 用于检测未使用的代码和依赖，帮助维护代码库的整洁。运行命令：
```bash
pnpm knip
```

### Husky 与 lint-staged
- **pre-commit**: 执行 `lint-staged`，仅检查暂存文件
- **commit-msg**: 执行 `commitlint`，验证提交信息格式

### 其他工具
- **Biome**: 代码格式化和 linting
- **Vitest**: 单元测试
- **semantic-release**: 自动化发布
- **Rolldown**: 构建工具（Rust 编写，比 esbuild 更快）

**Section sources**
- [knip.json](file://knip.json#L1-L12)
- [package.json](file://package.json#L27-L43)

## 良好的PR示例

### 清晰的描述
PR 描述应包含：
- 功能目的
- 实现方案
- 影响范围
- 相关截图（如适用）

### 充分的测试
确保新增功能或修复的 Bug 都有相应的测试覆盖，运行 `pnpm coverage` 验证覆盖率。

### 文档更新
更新相关文档，包括：
- README.md
- docs/development-guide.md
- 包的 README.md

### 提交历史
保持提交历史清晰，每个提交应有明确的目的，遵循提交规范。

## 入门贡献方式

### 文档改进
文档是项目的重要组成部分，欢迎改进：
- 修正拼写错误
- 补充缺失的说明
- 优化文档结构
- 添加使用示例

### Bug 报告
发现 Bug 时，请提供：
- 复现步骤
- 预期行为
- 实际行为
- 环境信息（Node.js 版本、pnpm 版本等）

这些贡献方式是参与项目的良好起点，无需深入了解代码实现。

**Section sources**
- [docs/development-guide.md](file://docs/development-guide.md#L1-L447)
- [docs/architecture.md](file://docs/architecture.md#L1-L355)

## 结论
感谢您阅读本贡献指南！我们期待您的参与和贡献。遵循上述流程和规范，您将能够顺利地为项目做出贡献。如有任何疑问，请在 GitHub Discussions 中提问。