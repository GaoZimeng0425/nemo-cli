# 🎉 新布局算法已部署!

## ✅ 已修复并改进

### 🚀 使用 D3 力导向布局

现在使用 **D3.js 的力导向布局算法**,它会:

- ✅ **自动聚集相关节点**
- ✅ **清晰的依赖关系可视化**
- ✅ **自然的图结构**
- ✅ **智能的节点间距**

### 📊 三种布局算法可选

1. **力导向布局** (默认/推荐)
   - 🎯 最适合查看依赖关系
   - 📍 相关节点自动聚集
   - 🔀 清晰的连接线

2. **层次布局**
   - 📊 树状结构
   - 📐 层级分明
   - 🌳 适合查看依赖深度

3. **网格布局**
   - 🔲 简单规则排列
   - 📏 固定间距

## 🔄 如何使用

### 1. 刷新浏览器

```bash
# 服务器还在运行
# 直接刷新浏览器页面: http://localhost:3000
```

### 2. 加载你的数据

- 拖拽 `ai-docs/deps.json`
- 或点击选择文件

### 3. 查看力导向布局效果

你会看到:
- ✅ 节点分散但有逻辑地组织
- ✅ 相关节点聚集在一起
- ✅ 连接线清晰可见
- ✅ 可以拖拽节点调整位置

### 4. 尝试不同布局

在顶部控制面板中,找到"布局"下拉菜单:
- 选择"力导向 (推荐)" - 最佳视图
- 选择"层次布局" - 树状结构
- 选择"网格布局" - 规则排列

## 🎯 力导向布局的优势

### 1️⃣ 自然的聚类
```
[组件簇]
    ┌─────────┐
    │ Button  │──→ [Button.stories]
    │         │
    └─────────┘
        ↓
    ┌─────────┐
    │ Form    │──→ [Input]
    └─────────┘
```

### 2️⃣ 清晰的依赖链
- 入口节点在中心
- 依赖节点向外扩展
- 循环依赖会形成紧密的环

### 3️⃣ 交互性
- 拖拽节点会触发物理模拟
- 节点会自动调整位置
- 平滑的动画效果

## 🎨 使用技巧

### 查看特定模块

1. **使用 Scope 过滤**
   - 只勾选 "App" 和 "Workspace"
   - 查看项目核心代码

2. **使用页面视图**
   - 选择"页面"视图
   - 选择特定路由
   - 只看该页面的依赖树

3. **使用搜索**
   - 输入组件名如 "Button"
   - 相关节点会高亮

### 查看循环依赖

1. **选择"循环"视图**
   - 只显示 SCC 组
   - 红色脉冲动画标记循环

2. **点击循环中的节点**
   - 详情面板显示完整 SCC 信息
   - 列出所有循环相关的节点

## ⚙️ 布局参数调整

力导向布局参数 (在代码中):
- **iterations**: 500 (布局迭代次数,越多越精确)
- **distance**: 150px (理想连接距离)
- **charge**: -300 (节点排斥力,负值越大越分散)
- **collide radius**: 80px (碰撞避免半径)

## 🚀 现在就试试!

```bash
# 1. 生成数据 (如果还没有)
cd /path/to/your-nextjs-app
nd analyze --format ai

# 2. 启动可视化 (如果还没启动)
nd visualize --open

# 3. 刷新浏览器

# 4. 加载 ai-docs/deps.ai.json

# 5. 查看美丽的力导向布局! 🎉
```

## 📸 效果预览

### 力导向布局
- 🎯 相关节点自动聚集
- 🔗 连接线清晰可见
- 📐 节点分散但有逻辑

### 层次布局
- 🌳 树状结构
- 📊 层级分明
- ⬇️ 从上到下的依赖流

### 网格布局
- 🔲 规则排列
- 📏 固定间距
- 📊 简单直接

---

**力导向布局推荐用于:**
- ✅ 查看整体依赖关系
- ✅ 发现代码组织结构
- ✅ 识别耦合度高的模块
- ✅ 分析循环依赖

**现在就试试吧!刷新浏览器,加载你的数据!** 🚀
