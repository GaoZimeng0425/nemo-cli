# äº¤äº’å¼ UI åŠŸèƒ½å®ç°æ–‡æ¡£

> æ›´æ–°æ—¥æœŸï¼š2026-02-04
> åŠŸèƒ½ç‰ˆæœ¬ï¼š1.0.0
> æäº¤å“ˆå¸Œï¼šb8786ea

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸º nemo-cli æ·»åŠ äº†ä¸¤ä¸ªåŸºäº React Ink çš„äº¤äº’å¼ UI åŠŸèƒ½ï¼Œå¤§å¹…æå‡äº†ç”¨æˆ·ä½“éªŒï¼š

1. **å¢å¼ºçš„ Stash åˆ—è¡¨æ˜¾ç¤º** - ä½¿ç”¨ Ink ç»„ä»¶çš„ç¾è§‚å¡ç‰‡å¼å¸ƒå±€
2. **äº¤äº’å¼çŠ¶æ€æŸ¥çœ‹å™¨** - ä¸¤æ å¸ƒå±€çš„æ–‡ä»¶çŠ¶æ€å’Œ diff æŸ¥çœ‹å™¨

---

## ğŸ¨ åŠŸèƒ½ä¸€ï¼šå¢å¼ºçš„ Stash åˆ—è¡¨æ˜¾ç¤º

### æ ¸å¿ƒç‰¹æ€§

- âœ¨ **å¡ç‰‡å¼å¸ƒå±€**ï¼šæ¯ä¸ª stash æ˜¾ç¤ºåœ¨ç‹¬ç«‹çš„åœ†è§’è¾¹æ¡†å¡ç‰‡ä¸­
- ğŸ¨ **å½©è‰²è¾¹æ¡†**ï¼šæœ€æ–°çš„ stash æ˜¾ç¤ºç»¿è‰²è¾¹æ¡†ï¼Œæ—§çš„æ˜¾ç¤ºç°è‰²
- ğŸ“„ **è¯¦ç»†ä¿¡æ¯**ï¼šæ˜¾ç¤º stash å¼•ç”¨ã€åˆ†æ”¯ã€æ¶ˆæ¯ã€æ–‡ä»¶æ•°é‡å’Œæ–‡ä»¶åˆ—è¡¨
- ğŸ”¤ **ä¸­æ–‡å‹å¥½**ï¼šæ”¯æŒä¸­æ–‡æ¶ˆæ¯å’Œæ–‡ä»¶åæ˜¾ç¤º

### ç»„ä»¶ç»“æ„

**æ–‡ä»¶ä½ç½®ï¼š** `packages/ui/src/components/stash-list.tsx`

```tsx
export interface StashItem {
  ref: string        // stash@{0}
  branch: string     // main
  message: string    // stash æ¶ˆæ¯
  files: string[]    // ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨
  fileCount: number  // æ–‡ä»¶æ•°é‡
}

export const StashList: FC<StashListProps> = ({ stashes }) => {
  // æ¸²æŸ“ stash åˆ—è¡¨
}

export const renderStashList = (stashes: StashItem[]) => {
  // ç›´æ¥æ¸²æŸ“ç»„ä»¶
}
```

### ä½¿ç”¨æ–¹å¼

åœ¨ `packages/git/src/commands/stash.ts` ä¸­é›†æˆï¼š

```typescript
const handleList = handleCheck(async (stashes: string[]) => {
  // è½¬æ¢ä¸º ink ç»„ä»¶éœ€è¦çš„æ ¼å¼
  const stashItems: StashItem[] = await Promise.all(
    stashes.map(async (stash) => {
      const stashInfo = parseStashEntry(stash)
      const files = await getStashFiles(stashInfo.ref)

      return {
        ref: stashInfo.ref,
        branch: stashInfo.branch,
        message: stashInfo.message,
        files,
        fileCount: files.length,
      }
    }),
  )

  // ä½¿ç”¨ ink ç»„ä»¶æ¸²æŸ“
  await renderStashList(stashItems)
})
```

### å‘½ä»¤è°ƒç”¨

```bash
ng stash list
# æˆ–
ng st ls
```

### UI æ•ˆæœ

```
ğŸ“¦ æ‰¾åˆ° 3 ä¸ª stash

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ stash@{0} â”‚ main                           æœ€æ–°           â”‚
â”‚ â””â”€ checkout:main@2026-02-04T10-24-57                        â”‚
â”‚                                                            â”‚
â”‚ ğŸ“„ 12 ä¸ªæ–‡ä»¶                                                â”‚
â”‚   â€¢ src/index.ts                                           â”‚
â”‚   â€¢ src/utils.ts                                           â”‚
â”‚   ... è¿˜æœ‰ 9 ä¸ªæ–‡ä»¶                                        â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

---

## ğŸ–¥ï¸ åŠŸèƒ½äºŒï¼šäº¤äº’å¼çŠ¶æ€æŸ¥çœ‹å™¨

### æ ¸å¿ƒç‰¹æ€§

- ğŸ“± **ä¸¤æ å¸ƒå±€**ï¼šå·¦ä¾§æ–‡ä»¶åˆ—è¡¨ï¼ˆ30%ï¼‰ï¼Œå³ä¾§ diff å†…å®¹ï¼ˆ70%ï¼‰
- âŒ¨ï¸ **Vim é£æ ¼é”®ä½**ï¼šæ”¯æŒ hjkl é”®ä½å¯¼èˆª
- ğŸ¯ **é¢æ¿åˆ‡æ¢**ï¼šâ† â†’ åœ¨æ–‡ä»¶åˆ—è¡¨å’Œ diff é¢æ¿é—´åˆ‡æ¢
- ğŸ“œ **æ»šåŠ¨æŸ¥çœ‹**ï¼šâ†‘ â†“ æ»šåŠ¨æŸ¥çœ‹é•¿ diff å†…å®¹
- ğŸŒˆ **è¯­æ³•é«˜äº®**ï¼šç»¿(+)çº¢(-)é’(@@)é»„(diff)å½©è‰²æ˜¾ç¤º
- ğŸ“ **ç»ˆç«¯è‡ªé€‚åº”**ï¼šæ ¹æ®ç»ˆç«¯çª—å£é«˜åº¦åŠ¨æ€è°ƒæ•´

### ç»„ä»¶ç»“æ„

**æ–‡ä»¶ä½ç½®ï¼š** `packages/ui/src/components/status-viewer.tsx`

```tsx
export interface StatusFile {
  path: string       // æ–‡ä»¶è·¯å¾„
  status: string     // M=ä¿®æ”¹, A=æ·»åŠ , D=åˆ é™¤
  staged: boolean    // æ˜¯å¦å·²æš‚å­˜
}

export const StatusViewer: FC<StatusViewerProps> = ({
  files,
  onExit
}) => {
  // äº¤äº’å¼çŠ¶æ€æŸ¥çœ‹å™¨å®ç°
}

export const renderStatusViewer = (files: StatusFile[]) => {
  // ç›´æ¥æ¸²æŸ“ç»„ä»¶
}
```

### å­ç»„ä»¶

#### DiffViewer

è´Ÿè´£æ˜¾ç¤ºå•ä¸ªæ–‡ä»¶çš„ diff å†…å®¹ï¼š

```tsx
const DiffViewer: FC<{
  filePath: string
  scrollTop: number
  visibleLines: number
}> = ({ filePath, scrollTop, visibleLines }) => {
  // è·å–å¹¶æ¸²æŸ“ diff å†…å®¹
}
```

**ç‰¹æ€§ï¼š**
- ä½¿ç”¨ `xASync` æ‰§è¡Œ `git diff` å‘½ä»¤
- æ ¹æ®ç»ˆç«¯é«˜åº¦è®¡ç®—å¯è§è¡Œæ•°
- æ”¯æŒæ»šåŠ¨æŸ¥çœ‹é•¿ diff
- æ˜¾ç¤ºæ»šåŠ¨æŒ‡ç¤ºå™¨ï¼ˆâ–²â–¼ï¼‰

### é”®ç›˜å¯¼èˆª

| é”®ä½ | æ–‡ä»¶åˆ—è¡¨é¢æ¿ | Diff é¢æ¿ |
|------|-------------|-----------|
| `k` / `â†‘` | å‘ä¸Šé€‰æ‹©æ–‡ä»¶ | å‘ä¸Šæ»šåŠ¨ diff |
| `j` / `â†“` | å‘ä¸‹é€‰æ‹©æ–‡ä»¶ | å‘ä¸‹æ»šåŠ¨ diff |
| `h` / `â†` | - | åˆ‡æ¢åˆ°æ–‡ä»¶åˆ—è¡¨é¢æ¿ |
| `l` / `â†’` | åˆ‡æ¢åˆ° diff é¢æ¿ | - |
| `Enter` / `q` | é€€å‡ºæŸ¥çœ‹å™¨ | é€€å‡ºæŸ¥çœ‹å™¨ |

### ç„¦ç‚¹ç®¡ç†

ä½¿ç”¨çŠ¶æ€ç®¡ç†å½“å‰èšç„¦çš„é¢æ¿ï¼š

```tsx
type FocusPanel = 'files' | 'diff'

const [focusPanel, setFocusPanel] = useState<FocusPanel>('files')
```

- å½“å‰èšç„¦çš„é¢æ¿è¾¹æ¡†æ˜¾ç¤ºä¸º **ç»¿è‰²**
- éèšç„¦é¢æ¿è¾¹æ¡†æ˜¾ç¤ºä¸º **ç°è‰²/è“è‰²**
- æ˜¾ç¤º `â—€` æˆ– `â–¶` æ ‡è®°æŒ‡ç¤ºå½“å‰èšç„¦ä½ç½®

### ç»ˆç«¯é€‚é…

åŠ¨æ€è®¡ç®—å¯è§è¡Œæ•°ï¼š

```tsx
const { stdout } = useApp()
const terminalHeight = stdout?.rows || 24
const visibleLines = Math.max(10, terminalHeight - 6)
```

### å‘½ä»¤è°ƒç”¨

**æ–‡ä»¶ä½ç½®ï¼š** `packages/git/src/commands/status.ts`

```bash
ng status
# æˆ–
ng s
```

### UI æ•ˆæœ

```
â”Œâ”€ Changed Files (3) â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚                                    â”‚
â”‚ âœ“ M src/index.ts  â—€               â”‚ src/index.ts (Unstaged)           â”‚
â”‚   M src/utils.ts                   â”‚                                    â”‚
â”‚   A package.json                   â”‚ diff --git a/src/index.ts b/src... â”‚
â”‚                                     â”‚                                    â”‚
â”‚ â†‘â†“/jk Navigate | â†’/l Diff | Enter  â”‚  const x = 1  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                     â”‚ - const x = 2                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°ç»†èŠ‚

### Ink ç»„ä»¶æ¨¡å¼

æ‰€æœ‰ UI ç»„ä»¶éµå¾ªç»Ÿä¸€çš„æ¨¡å¼ï¼š

```tsx
import type { FC } from 'react'
import { Box, Text, render } from 'ink'

// ç»„ä»¶å®šä¹‰
export const MyComponent: FC<Props> = ({ ... }) => {
  return (
    <Box>
      <Text>Content</Text>
    </Box>
  )
}

// æ¸²æŸ“å‡½æ•°
export const renderMyComponent = (props: Props) => {
  const { waitUntilExit } = render(<MyComponent {...props} />)
  return waitUntilExit()
}
```

### Git æ“ä½œé›†æˆ

ä½¿ç”¨ `xASync` å·¥å…·å‡½æ•°æ‰§è¡Œ Git å‘½ä»¤ï¼š

```tsx
import { xASync } from '@nemo-cli/shared'

const [error, result] = await xASync('git', ['diff', filePath], {
  quiet: true
})

if (error) {
  // å¤„ç†é”™è¯¯
}

const lines = result.stdout.split('\n')
```

### çŠ¶æ€ç®¡ç†

ä½¿ç”¨ React Hooks ç®¡ç†ç»„ä»¶çŠ¶æ€ï¼š

```tsx
// é€‰æ‹©çŠ¶æ€
const [selectedIndex, setSelectedIndex] = useState(0)

// ç„¦ç‚¹çŠ¶æ€
const [focusPanel, setFocusPanel] = useState<'files' | 'diff'>('files')

// æ»šåŠ¨ä½ç½®
const [scrollTop, setScrollTop] = useState(0)
```

### é”®ç›˜è¾“å…¥å¤„ç†

ä½¿ç”¨ Ink çš„ `useInput` Hookï¼š

```tsx
useInput((input, key) => {
  if (key.upArrow || input === 'k') {
    // å‘ä¸Šç§»åŠ¨
  } else if (key.downArrow || input === 'j') {
    // å‘ä¸‹ç§»åŠ¨
  } else if (key.return || input === 'q') {
    // é€€å‡º
    onExit()
    exit()
  }
})
```

### ç»ˆç«¯å°ºå¯¸è·å–

ä½¿ç”¨ Ink çš„ `useApp` Hookï¼š

```tsx
const { stdout, exit } = useApp()
const terminalHeight = stdout?.rows || 24
```

---

## ğŸ“¦ ä¾èµ–å…³ç³»

### æ–°å¢ç»„ä»¶

- `StashList` - Stash åˆ—è¡¨ç»„ä»¶
- `StatusViewer` - äº¤äº’å¼çŠ¶æ€æŸ¥çœ‹å™¨
- `DiffViewer` - Diff å†…å®¹æ˜¾ç¤ºå™¨

### ä¾èµ–çš„åŒ…

- `ink` - React ç»ˆç«¯æ¸²æŸ“
- `@nemo-cli/shared` - xASync å·¥å…·å‡½æ•°
- `@nemo-cli/ui` - UI ç»„ä»¶å¯¼å‡º

### è¢«ä¾èµ–çš„å‘½ä»¤

- `ng stash list` - ä½¿ç”¨ `StashList`
- `ng status` - ä½¿ç”¨ `StatusViewer`

---

## ğŸ¯ è®¾è®¡å†³ç­–

### ä¸ºä»€ä¹ˆé€‰æ‹© Inkï¼Ÿ

1. **React ç”Ÿæ€**ï¼šç†Ÿæ‚‰çš„ React å¼€å‘æ¨¡å¼
2. **ç»„ä»¶åŒ–**ï¼šå¯å¤ç”¨çš„ UI ç»„ä»¶
3. **å“åº”å¼**ï¼šè‡ªåŠ¨å¤„ç†é‡ç»˜å’Œæ›´æ–°
4. **ä¸°å¯Œçš„ç”Ÿæ€**ï¼šå¤§é‡çš„ Ink ç»„ä»¶åº“

### ä¸ºä»€ä¹ˆæ”¯æŒ hjklï¼Ÿ

1. **Vim ç”¨æˆ·ä¹ æƒ¯**ï¼šå¤§é‡å¼€å‘è€…ä½¿ç”¨ Vim é”®ä½
2. **æ•ˆç‡æå‡**ï¼šæ— éœ€ç¦»å¼€ä¸»é”®ç›˜åŒºåŸŸ
3. **å¯é…ç½®**ï¼šåŒæ—¶æ”¯æŒç®­å¤´é”®ï¼Œç…§é¡¾ä¸åŒç”¨æˆ·

### ä¸ºä»€ä¹ˆä½¿ç”¨ä¸¤æ å¸ƒå±€ï¼Ÿ

1. **æ¸…æ™°çš„ä¿¡æ¯å±‚æ¬¡**ï¼šæ–‡ä»¶åˆ—è¡¨å’Œ diff åˆ†ç¦»
2. **é«˜æ•ˆå¯¼èˆª**ï¼šå¿«é€Ÿåˆ‡æ¢æ–‡ä»¶æŸ¥çœ‹ diff
3. **ç»ˆç«¯å‹å¥½**ï¼šå……åˆ†åˆ©ç”¨ç»ˆç«¯å®½åº¦

---

## ğŸš€ æœªæ¥æ”¹è¿›æ–¹å‘

### çŸ­æœŸæ”¹è¿›

- [ ] æ·»åŠ æœç´¢åŠŸèƒ½ï¼ˆåœ¨æ–‡ä»¶åˆ—è¡¨ä¸­æœç´¢ï¼‰
- [ ] æ”¯æŒæš‚å­˜/å–æ¶ˆæš‚å­˜æ–‡ä»¶ï¼ˆç›´æ¥åœ¨æŸ¥çœ‹å™¨ä¸­æ“ä½œï¼‰
- [ ] æ·»åŠ æ–‡ä»¶çŠ¶æ€è¿‡æ»¤ï¼ˆåªçœ‹å·²æš‚å­˜/æœªæš‚å­˜ï¼‰
- [ ] æ”¯æŒæ›´å¤šçš„ diff æ ¼å¼ï¼ˆword diff, color wordsï¼‰

### é•¿æœŸæ”¹è¿›

- [ ] æ”¯æŒåˆ†å±æ˜¾ç¤ºï¼ˆåŒæ—¶æŸ¥çœ‹å¤šä¸ªæ–‡ä»¶çš„ diffï¼‰
- [ ] æ·»åŠ  diff ç¼–è¾‘åŠŸèƒ½ï¼ˆç›´æ¥ä¿®æ”¹ diffï¼‰
- [ ] æ”¯æŒ stash åº”ç”¨é¢„è§ˆï¼ˆåœ¨åº”ç”¨å‰æŸ¥çœ‹ stash å†…å®¹ï¼‰
- [ ] æ·»åŠ å†²çªè§£å†³ç•Œé¢ï¼ˆå¯è§†åŒ–å†²çªï¼‰

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæŸ¥çœ‹ Stash åˆ—è¡¨

```bash
$ ng stash list

ğŸ“¦ æ‰¾åˆ° 2 ä¸ª stash

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ stash@{0} â”‚ main                           æœ€æ–°           â”‚
â”‚ â””â”€ WIP: feature implementation                               â”‚
â”‚                                                            â”‚
â”‚ ğŸ“„ 3 ä¸ªæ–‡ä»¶                                                 â”‚
â”‚   â€¢ src/index.ts                                           â”‚
â”‚   â€¢ src/utils.ts                                           â”‚
â”‚   â€¢ package.json                                           â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ stash@{1} â”‚ feature/test                                    â”‚
â”‚ â””â”€ WIP: test implementation                                â”‚
â”‚                                                            â”‚
â”‚ ğŸ“„ 1 ä¸ªæ–‡ä»¶                                                 â”‚
â”‚   â€¢ src/test.ts                                            â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

### ç¤ºä¾‹ 2ï¼šäº¤äº’å¼çŠ¶æ€æŸ¥çœ‹

```bash
$ ng status

[å¯åŠ¨äº¤äº’å¼ç•Œé¢]
- å·¦ä¾§æ˜¾ç¤ºä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨
- å³ä¾§æ˜¾ç¤ºé€‰ä¸­æ–‡ä»¶çš„ diff
- ä½¿ç”¨ j/k æˆ– â†‘â†“ é€‰æ‹©æ–‡ä»¶
- ä½¿ç”¨ h/l æˆ– â†â†’ åˆ‡æ¢é¢æ¿
- æŒ‰ q æˆ– Enter é€€å‡º
```

---

## ğŸ”— ç›¸å…³èµ„æº

- [Ink å®˜æ–¹æ–‡æ¡£](https://github.com/vadimdemedes/ink)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev)
- [@inkjs/ui ç»„ä»¶åº“](https://github.com/vadimdemedes/ink-ui)

---

_æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š2026-02-04_
_åŠŸèƒ½å®ç°ç‰ˆæœ¬ï¼š1.0.0_
